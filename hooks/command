#!/bin/bash

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

source $SCRIPT_DIR/functions.sh

set -e

ENVIRONMENT="$BUILDKITE_PLUGIN_ECS_PIPELINE_DEPLOYMENT_ENVIRONMENT"
ACCOUNT_ID="$BUILDKITE_PLUGIN_ECS_PIPELINE_DEPLOYMENT_ACCOUNT_ID"

if [[ $BUILDKITE_PLUGIN_ECS_PIPELINE_DEPLOYMENT_BETA == true ]]; then
    $SCRIPT_DIR/deploy_ecs.sh $ENVIRONMENT $ACCOUNT_ID $BUILDKITE_PLUGIN_ECS_PIPELINE_DEPLOYMENT_DEPLOY_TAG
    $SCRIPT_DIR/healthcheck.sh $ENVIRONMENT $ACCOUNT_ID 
fi